(function(){var a=this,b=function(a){return a instanceof b?a:!this instanceof b?new b(a):void(this._wrapped=a)};a.BOUNDLESS=b,b.VERSION="0.1",b.AnimationDuration=1e3,b.initialize=function(){b.currentView=!1,b.videos=new b.Videos,b.router=new b.Router,b.search=new b.Search,b.uwtiles=new b.UWTiles,b.map=new b.Map,b.navigation=new b.Navigation,Backbone.history.start()},jQuery(document).ready(b.initialize),b.Navigation=Backbone.View.extend({el:".navigation",message:"#message",events:{"mouseenter li":"addBlur","mouseleave li":"removeBlur","click .show-nav":"segueIn"},initialize:function(){_.bindAll(this,"addBlur","removeBlur","segueIn","segueOut","show","animate"),this.$message=$("#message"),this.animate(-230,!0)},addBlur:function(){this.$message.addClass("blur")},removeBlur:function(){this.$message.removeClass("blur")},segueOut:function(){console.log("Hiding the navigation"),this.animate(-1600)},segueIn:function(){this.animate(-230,!0),this.show()},hide:function(){this.$message.fadeOut(b.AnimationDuration),console.log("Hiding the message")},show:function(){this.$message.fadeIn(b.AnimationDuration),console.log("Showing the navigation")},animate:function(a,b){this.$el.animate({left:a},{duration:500,easing:"easeInOutQuad"}),b&&(console.log("Bounce the tiles"),this.$el.find("li").animate({marginRight:20,opacity:1},{duration:1500,easing:"easeOutElastic"}))}}),b.Search=Backbone.View.extend({el:"li.search",searchBar:"input.search-bar",events:{click:"expandTheSearchBar"},initialize:function(){_.bindAll(this,"expandTheSearchBar"),this.$searchBar=$(this.searchBar)},expandTheSearchBar:function(){this.$searchBar.toggleClass("open")}}),b.UWTiles=Backbone.View.extend({name:"UW Campus",alt:"UW Map",tileSize:new google.maps.Size(256,256),maxZoom:19,minZoom:1,scrollwheel:!1,streetViewControl:!1,initialize:function(){},getTile:function(a,b,c){var d=c.createElement("DIV");if(!this.withinLoadingBounds(a,b))return d.style.width="256px",d.style.height="256px",d.style.background="#FFFFFF",d;var e=c.createElement("IMG");return e.src="http://www.washington.edu/wp-content/themes/maps/tiles/"+b+"_"+a.x+"_"+a.y+".png",e.onerror=function(){d.removeChild(e),d.style.width="256px",d.style.height="256px",d.style.background="#FFFFFF"},d.appendChild(e),d},withinLoadingBounds:function(a,b){return!(a.x>Math.floor(84049/Math.pow(2,19-b))||a.x<Math.floor(83996/Math.pow(2,19-b))||a.y<Math.floor(182980/Math.pow(2,19-b))||a.y>Math.floor(183017/Math.pow(2,19-b)))}}),b.youtube_api_ready=!1,b.YouTubeAPIReady=new Event("youtube_api_ready"),window.onYouTubeIframeAPIReady=function(){b.youtube_api_ready=!0,this.dispatchEvent(b.YouTubeAPIReady)},b.Video=Backbone.Model.extend({}),b.Videos=Backbone.Collection.extend({model:b.Video,is_ready:!1,view_to_render:void 0,initialize:function(){_.bindAll(this,"fetch_success"),this.url="?json=boundless_video.get_videos",this.fetch({success:this.fetch_success})},fetch_success:function(){this.is_ready=!0,void 0!==this.view_to_render&&this.view_to_render.data_prep()}}),b.Video.View=Backbone.View.extend({template:'<div id="<%= slug %>" class="fullscreen behind" style="background-image:url(<%= image %>)"><h2 class="video-title"><%= title %></h2><button class="play"></button><div class="behind boundless-youtube" id="video<%= video %>" aria-label="Video: <%= title %>"></div><div class="blurb"><%= text %></div></div>',el:"#message",is_playing:!1,events:{"click button.play":"buttonClick",keyup:"checkEscape"},initialize:function(a){_.bindAll(this,"render","data_prep","onReady","buttonClick","checkEscape","onStateChange","youtube_iframe","hide","show"),this.collection=b.videos,this.slug=a.slug,this.collection.is_ready?this.data_prep(a):this.collection.view_to_render=this,this.player_ready=!1},data_prep:function(){for(var a=0;a<this.collection.models.length;a++)this.collection.models[a].get("slug")==this.slug&&(this.model=this.collection.models[a]);this.model?(this.render(),b.youtube_api_ready?this.youtube_iframe():window.addEventListener("youtube_api_ready",this.youtube_iframe)):console.log("no model with slug "+this.slug)},render:function(){var a=this.model.toJSON(),b=_.template(this.template,a);this.$el.append(b),this.$el=this.$el.find("#"+this.slug),this.$button=this.$el.find("button.play"),this.show()},youtube_iframe:function(){var a={};this.modest&&(a={rel:0,controls:0,modestbranding:1}),this.uwplayer=new YT.Player("video"+this.model.get("video"),{videoId:this.model.get("video"),playerVars:a,width:"100%",height:"100%",events:{onReady:this.onReady,onStateChange:this.onStateChange}}),this.$iframe=this.$el.find("#video"+this.model.get("video"))},onReady:function(){this.play(this.model.get("video"))},onStateChange:function(a){0===a.data&&this.is_playing&&this.buttonClick()},play:function(a,b){b=b||!1,b?(this.uwplayer.loadVideoById(a),this.$button.focus(),this.is_playing=!0):this.uwplayer.cueVideoById(a)},buttonClick:function(){this.is_playing?(this.is_playing=!1,this.uwplayer.stopVideo(),this.$button.removeClass("close"),this.$iframe.addClass("behind")):(this.$iframe.removeClass("behind"),this.play(this.model.get("video"),!0),this.$button.addClass("close"))},checkEscape:function(a){this.is_playing&&27==a.keyCode&&(a.preventDefault(),this.buttonClick())},hide:function(){this.is_playing&&this.uwplayer&&this.uwplayer.stopVideo(),this.$button.removeClass("close"),this.$iframe.addClass("behind"),this.$el.fadeOut()},show:function(){this.$el.fadeIn()}}),b.Map=Backbone.View.extend({el:"#map",infoWindow:'<div class="overlay"></div>',googleMapIsLoaded:!1,settings:{name:"campusmap",allowedBounds:new google.maps.LatLngBounds(new google.maps.LatLng(47.647523,-122.325039),new google.maps.LatLng(47.664983,-122.290106)),allowedZoom:16,map:{zoom:17,center:new google.maps.LatLng(47.653851681095,-122.30780562698),minZoom:1,maxZoom:19,disableDoubleClickZoom:!1,mapTypeControl:!1},icon:{url:"wp-content/themes/be-boundless/less/svg/map-marker.svg",size:new google.maps.Size(85,85),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(42.5,42.5)},marker:{}},initialize:function(){_.bindAll(this,"delegateGoogleMapEvents","handleCenterChanged","handleZoomChanged","getMapType","putMarkersOnMap","render","segueIn","hide","googleMapLoaded"),this.points=new b.Map.Points,this.points.on("sync",this.render)},render:function(){this.map=new google.maps.Map(this.el,this.settings.map),this.map.mapTypes.set(this.settings.name,b.uwtiles),this.map.setMapTypeId(this.settings.name),this.bounds=new google.maps.LatLngBounds,this.points.each(this.putMarkersOnMap),this.delegateGoogleMapEvents()},delegateGoogleMapEvents:function(){google.maps.event.addListener(this.map,"center_changed",this.handleCenterChanged),google.maps.event.addListener(this.map,"zoom_changed",this.handleZoomChanged)},handleCenterChanged:function(){this.map.setMapTypeId(this.getMapType())},handleZoomChanged:function(){this.map.setMapTypeId(this.getMapType())},getMapType:function(){return!this.settings.allowedBounds.contains(this.map.getCenter())||this.map.getZoom()<this.settings.allowedZoom?google.maps.MapTypeId.ROADMAP:this.settings.name},putMarkersOnMap:function(a){var c=new google.maps.Marker(this.settings.marker),d=new google.maps.LatLng(a.get("coordinate").latitude,a.get("coordinate").longitude),e=new b.Map.InfoWindow(this.map,d,a);this.bounds.extend(d),c.setPosition(d),c.setTitle(a.get("title")),c.setText(a.get("text")),c.setMap(this.map),c.setIcon(this.settings.icon),c.set("infoWindow",e),google.maps.event.addListener(c,"click",this.handleClickMarker),this.map.fitBounds(this.bounds)},handleClickMarker:function(){this.getMap().panTo(this.getPosition()),this.infoWindow.setMap(this.getMap())},segueIn:function(){console.log("Map segue in"),b.router.trigger("newViewLoaded"),this.$el.hide().css("z-index",0).fadeIn(b.AnimationDuration)},show:function(){console.log("map show"),this.googleMapIsLoaded&&this.segueIn()},hide:function(){this.$el.fadeOut(1e3,function(){$(this).css("z-index",0).hide()})},googleMapLoaded:function(){this.googleMapIsLoaded=!0,_.delay(this.segueIn,300)}}),b.Map.Point=Backbone.Model.extend({}),b.Map.Points=Backbone.Collection.extend({url:"?json=map_point.get_map_points",model:b.Map.Point,initialize:function(){this.on("error",this.error),this.fetch()},error:function(){console.log("There was an error retrieving the map points.")}}),b.Map.InfoWindow=function(a,b,c){this.div=document.createElement("div"),this.div.className="infowindow",this.div.innerHTML=_.template('<div class="image"><img src="<%= _.first(info.get("image")) %>" title="<%= info.get("title") %>" /><h3><%= info.get("title") %></h3></div><div class="text"><p><%= info.get("text") %></p><span class="close"></span><span class="open"></span></div>',{info:c}),this.point=b,this.setMap(a)},b.Map.InfoWindow.prototype=new google.maps.OverlayView,b.Map.InfoWindow.prototype.onAdd=function(){var a=this.getPanes();this.div.style.display="inline",a.floatPane.appendChild(this.div)},b.Map.InfoWindow.prototype.draw=function(){var a=this.getProjection(),b=a.fromLatLngToDivPixel(this.point);this.div.style.top=b.y+"px",this.div.style.left=b.x+"px"},b.Map.InfoWindow.prototype.onRemove=function(){this.div.style.display="none"},b.Router=Backbone.Router.extend({settings:{mprogress:{template:3}},routes:{"!/map":"segueToMap","!/video=:video":"initializeVideo","":"default"},initialize:function(){_.bindAll(this,"routeCompleted","segueToMap","initializeVideo"),this.mprogress=new Mprogress(this.settings.mprogress),this.on("route",this.routeCompleted),this.on("newViewLoaded",this.newViewLoaded)},initializeVideo:function(a){b.videoView||(b.videoView={}),b.videoView[a]?b.videoView[a].show():b.videoView[a]=new b.Video.View({slug:a}),this.currentView=b.videoView[a]},"default":function(){},routeCompleted:function(){console.log("Route is complete"),this.ready&&this.currentView&&this.currentView.segueIn(),this.ready||(this.ready=!0)},animateInInteraction:function(){b.interaction=new b.Interactions},newViewLoaded:function(){this.mprogress.end(),b.navigation.hide()},execute:function(a,c){console.log("Route is starting"),this.ready&&(this.currentView?(b.navigation.segueIn(),this.currentView.hide(),this.currentView=!1):(this.mprogress.start(),b.navigation.segueOut())),a&&a.apply(this,c)},segueToMap:function(){console.log("Segue to map"),this.currentView=b.map}})}).call(this);
//# sourceMappingURL=boundless.js.map